server:
  port: 9000
spring:
  application:
    name: oauth2-gateway
  sleuth:
    sampler:
      # 采样率：1.0 表示 100% 采样（生产环境建议降低）
      probability: 1.0
    web:
      # 跳过不需要追踪的路径
      skip-pattern: /actuator.*|/health.*
  zipkin:
    # Zipkin 服务器地址
    base-url: http://154.219.109.125:9411
    # 发送方式：web（HTTP）或 kafka/rabbitmq
    sender:
      type: web
    # 启用 Zipkin
    enabled: true
  thymeleaf:
    check-template-location: false
  cloud:
    nacos:
      discovery:
        server-addr: 154.219.109.125:8848
        namespace: public
        group: DEFAULT_GROUP
        # 开发环境允许启动失败容错
        fail-fast: false
    gateway:
      routes:
        # ========== 公开接口（不需要认证） ==========
        
        # 授权服务器路由
        # OAuth2 登录和认证接口
        - id: auth-server
          uri: http://localhost:8080
          predicates:
            - Path=/oauth/**,/login.html,/api/auth/**
          filters:
            - StripPrefix=0
        
        # 用户注册路由
        - id: user-register
          uri: http://localhost:8082
          predicates:
            - Path=/api/users/register
          filters:
            - StripPrefix=0
        
        # 邮箱验证路由
        - id: user-confirm
          uri: http://localhost:8082
          predicates:
            - Path=/api/users/confirm
          filters:
            - StripPrefix=0
        
        # 邮箱存在性检查路由
        - id: user-email-check
          uri: http://localhost:8082
          predicates:
            - Path=/api/users/exists/email/**
          filters:
            - StripPrefix=0
        
        # 安全验证接口
        - id: security-verification
          uri: http://localhost:8082
          predicates:
            - Path=/api/security/**
          filters:
            - StripPrefix=0
        
        # ========== 受保护接口（需要认证） ==========
        
        # 用户服务受保护路由
        - id: user-server
          uri: http://localhost:8082
          predicates:
            - Path=/api/**
          filters:
            - TokenRelay
        
        # 资源服务器路由
        - id: resource-server
          uri: http://localhost:8081
          predicates:
            - Path=/resource/**
          filters:
            - TokenRelay

# CORS 配置已完全移至 CorsConfig.java 类中处理

# 服务间认证配置
# 必须与其他服务保持一致
service:
  auth:
    # 密钥必须至少32位
    secret: your_32_character_secret_key_here_12345

# 日志配置 - 显示 TraceId 和 SpanId
logging:
  pattern:
    level: '%5p [${spring.application.name:},%X{traceId:-},%X{spanId:-}]'
  level:
    root: INFO
    com.example: INFO
    # Sleuth 日志级别
    org.springframework.cloud.sleuth: DEBUG