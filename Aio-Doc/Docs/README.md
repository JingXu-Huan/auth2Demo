# IM 系统 API 文档总览

## 📚 项目简介

本项目是一个类似飞书的企业级即时通讯系统，提供完整的消息、协作、音视频通话等功能。

---

## 🎯 核心功能模块

### 1️⃣ 基础通讯
- ✅ 单聊/群聊消息
- ✅ 文件传输（图片、视频、文档）
- ✅ 消息已读/未读
- ✅ 消息撤回/转发
- ✅ @提醒功能
- ✅ 消息搜索

### 2️⃣ 组织架构
- ✅ 部门管理
- ✅ 成员管理
- ✅ 权限管理
- ✅ 组织通讯录

### 3️⃣ 协作功能
- ✅ 群组管理
- ✅ 文档协作
- ✅ 日程管理
- ✅ 任务管理
- ✅ 会议管理

### 4️⃣ 音视频通话
- ✅ 语音通话
- ✅ 视频通话
- ✅ 多人会议
- ✅ 屏幕共享

### 5️⃣ 智能功能
- ✅ 消息搜索
- ✅ 文件搜索
- ✅ 智能推荐
- ✅ 机器人集成

---

## 📖 文档目录

### 核心服务 API

| 序号 | 文档名称 | 服务端口 | 说明 |
|------|---------|---------|------|
| 01 | [用户服务 API](./01-用户服务API文档.md) | 8001 | 用户注册、登录、资料管理、好友关系 |
| 02 | [消息服务 API](./02-消息服务API文档.md) | 8002 | 单聊、群聊、消息管理 |
| 03 | [群组服务 API](./03-群组服务API文档.md) | 8003 | 群组创建、成员管理、权限管理 |
| 04 | [在线状态服务 API](./04-在线状态服务API文档.md) | 8004 | 用户在线状态、心跳检测 |
| 05 | [文件服务 API](./05-文件服务API文档.md) | 8005 | 文件上传、下载、预览 |
| 06 | [推送服务 API](./06-推送服务API文档.md) | 8006 | 消息推送、通知管理 |
| 07 | [搜索服务 API](./07-搜索服务API文档.md) | 8007 | 全局搜索、消息搜索 |
| 08 | [音视频服务 API](./08-音视频服务API文档.md) | 8008 | 音视频通话、会议管理 |

### 扩展服务 API

| 序号 | 文档名称 | 服务端口 | 说明 |
|------|---------|---------|------|
| 11 | [组织架构服务 API](./11-组织架构服务API文档.md) | 8011 | 部门、成员、权限管理 |
| 12 | [日程服务 API](./12-日程服务API文档.md) | 8012 | 日程创建、提醒、共享 |
| 13 | [任务服务 API](./13-任务服务API文档.md) | 8013 | 任务创建、分配、跟踪 |
| 14 | [会议服务 API](./14-会议服务API文档.md) | 8014 | 会议预约、管理、录制 |
| 15 | [机器人服务 API](./15-机器人服务API文档.md) | 8015 | 机器人创建、消息处理 |
| 16 | [审批服务 API](./16-审批服务API文档.md) | 8016 | 审批流程、审批管理 |
| 17 | [云文档服务 API](./17-云文档服务API文档.md) | 8017 | 文档创建、协作编辑 |
| 18 | [通知中心 API](./18-通知中心API文档.md) | 8018 | 系统通知、消息订阅 |

### 协议与开发指南

| 序号 | 文档名称 | 说明 |
|------|---------|------|
| 09 | [WebSocket 协议文档](./09-WebSocket协议文档.md) | WebSocket 连接、消息格式 |
| 10 | [微服务开发指南](./10-微服务开发指南.md) | 服务开发规范、最佳实践 |
| 20 | [安全认证指南](./20-安全认证指南.md) | OAuth2、JWT、权限控制 |
| 21 | [错误码规范](./21-错误码规范.md) | 统一错误码定义 |
| 22 | [数据库设计文档](./22-数据库设计文档.md) | 数据表结构、索引设计 |

---

## 🏗️ 系统架构

```
┌─────────────────────────────────────────────────────────────┐
│                        客户端层                              │
│  Web端 / iOS端 / Android端 / PC端 / 小程序                  │
└────────────────────┬────────────────────────────────────────┘
                     │
┌────────────────────┴────────────────────────────────────────┐
│                      API 网关层                              │
│  IM-Gateway (负载均衡、路由、鉴权、限流)                     │
└────────────────────┬────────────────────────────────────────┘
                     │
┌────────────────────┴────────────────────────────────────────┐
│                    微服务层                                  │
├─────────────────────────────────────────────────────────────┤
│ 用户服务 │ 消息服务 │ 群组服务 │ 文件服务 │ 音视频服务      │
│ 搜索服务 │ 推送服务 │ 组织服务 │ 日程服务 │ 任务服务        │
│ 会议服务 │ 机器人服务│ 审批服务 │ 云文档服务│ 通知服务       │
└────────────────────┬────────────────────────────────────────┘
                     │
┌────────────────────┴────────────────────────────────────────┐
│                    中间件层                                  │
├─────────────────────────────────────────────────────────────┤
│ Nacos     │ Redis      │ RabbitMQ   │ Elasticsearch        │
│ Sentinel  │ PostgreSQL │ MinIO      │ WebRTC Server        │
│ Zipkin    │ MongoDB    │ Kafka      │ FFmpeg               │
└─────────────────────────────────────────────────────────────┘
```

---

## 🔐 认证与鉴权

### 认证方式
- **OAuth2 密码模式**: 用户登录获取 Token
- **JWT Token**: 访问令牌，有效期 2 小时
- **Refresh Token**: 刷新令牌，有效期 7 天

### 请求头格式
```
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
```

### WebSocket 认证
```javascript
const socket = new SockJS('http://localhost:8080/ws?token=xxx');
```

---

## 📊 通用响应格式

### 成功响应
```json
{
  "code": 200,
  "message": "success",
  "data": { ... },
  "timestamp": 1699612345678
}
```

### 失败响应
```json
{
  "code": 400,
  "message": "参数错误",
  "data": null,
  "timestamp": 1699612345678
}
```

---

## 🚀 快速开始

### 1. 用户注册登录
```bash
# 注册
curl -X POST http://localhost:8001/api/v1/users/register \
  -H "Content-Type: application/json" \
  -d '{
    "username": "zhangsan",
    "password": "Test@123",
    "email": "zhangsan@example.com",
    "phone": "13800138000"
  }'

# 登录
curl -X POST http://localhost:8001/api/v1/users/login \
  -H "Content-Type: application/json" \
  -d '{
    "username": "zhangsan",
    "password": "Test@123",
    "deviceType": "WEB",
    "deviceId": "device-123"
  }'
```

### 2. 建立 WebSocket 连接
```javascript
const token = 'your_jwt_token';
const socket = new SockJS(`http://localhost:8080/ws?token=${token}`);
const stompClient = Stomp.over(socket);

stompClient.connect({}, function(frame) {
  console.log('Connected: ' + frame);
  
  // 订阅私聊消息
  stompClient.subscribe('/user/queue/messages', function(message) {
    console.log('Received:', JSON.parse(message.body));
  });
});
```

### 3. 发送消息
```javascript
stompClient.send('/app/chat/private', {}, JSON.stringify({
  receiverId: 10002,
  messageType: 'TEXT',
  content: '你好！',
  clientMsgId: 'msg_' + Date.now()
}));
```

---

## 🔧 开发环境

### 必需组件
- **JDK**: 1.8+
- **Maven**: 3.6+
- **Node.js**: 14+ (前端开发)
- **Docker**: 20+ (容器化部署)

### 中间件
- **Nacos**: 2.2.0 (服务注册与配置)
- **Redis**: 6.2+ (缓存与会话)
- **PostgreSQL**: 13+ (关系数据库)
- **MongoDB**: 5.0+ (消息存储)
- **RabbitMQ**: 3.9+ (消息队列)
- **Elasticsearch**: 7.17+ (搜索引擎)
- **MinIO**: RELEASE.2023 (对象存储)

---

## 📝 版本历史

### v1.0.0 (2025-11-10)
- ✅ 完成用户服务 API
- ✅ 完成消息服务 API
- ✅ 完成群组服务 API
- ✅ 完成文件服务 API
- ✅ 完成音视频服务 API
- ✅ 完成 WebSocket 协议
- ✅ 完成基础架构搭建

### 计划中功能
- 🔄 组织架构服务
- 🔄 日程管理服务
- 🔄 任务管理服务
- 🔄 会议管理服务
- 🔄 机器人服务
- 🔄 审批流程服务
- 🔄 云文档协作

---

## 🤝 贡献指南

### 文档规范
1. 所有 API 必须包含完整的请求/响应示例
2. 参数说明必须详细，包含类型、必填、说明
3. 错误码必须统一，参考 [错误码规范](./21-错误码规范.md)
4. 数据模型使用 TypeScript 接口定义

### 提交规范
- `feat`: 新功能
- `fix`: 修复bug
- `docs`: 文档更新
- `refactor`: 代码重构
- `test`: 测试相关

---

## 📞 联系方式

- **技术支持**: tech-support@example.com
- **问题反馈**: issues@example.com
- **文档维护**: dev-team@example.com

---

## 📄 许可证

本项目采用 MIT 许可证

---

**文档版本**: v1.0.0  
**最后更新**: 2025-11-10  
**维护团队**: IM 开发团队
