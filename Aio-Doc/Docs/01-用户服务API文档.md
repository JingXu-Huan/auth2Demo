# ç”¨æˆ·æœåŠ¡ API æ–‡æ¡£

## ğŸ“‹ æœåŠ¡åŠŸèƒ½è¯´æ˜

ç”¨æˆ·æœåŠ¡æ˜¯æ•´ä¸ªIMç³»ç»Ÿçš„æ ¸å¿ƒåŸºç¡€æœåŠ¡ï¼Œè´Ÿè´£ç”¨æˆ·è´¦æˆ·çš„å…¨ç”Ÿå‘½å‘¨æœŸç®¡ç†ã€‚æœ¬æœåŠ¡æä¾›å®Œæ•´çš„ç”¨æˆ·è®¤è¯ã€æˆæƒã€ä¿¡æ¯ç®¡ç†å’Œç¤¾äº¤å…³ç³»ç®¡ç†åŠŸèƒ½ï¼Œæ˜¯æ‰€æœ‰å…¶ä»–æœåŠ¡çš„åŸºç¡€ä¾èµ–ã€‚

### æ ¸å¿ƒåŠŸèƒ½

#### 1. ç”¨æˆ·è´¦æˆ·ç®¡ç†
- **ç”¨æˆ·æ³¨å†Œ**: æ”¯æŒé‚®ç®±æ³¨å†Œï¼ŒåŒ…å«é‚®ç®±éªŒè¯ã€å¯†ç å¼ºåº¦æ ¡éªŒ
- **ç”¨æˆ·ç™»å½•**: æ”¯æŒé‚®ç®±å¯†ç ç™»å½•ã€ç¬¬ä¸‰æ–¹OAuthç™»å½•ï¼ˆGitee/GitHubï¼‰
- **è´¦æˆ·å®‰å…¨**: ç™»å½•å¤±è´¥é”å®šã€é•¿æœŸæœªç™»å½•éªŒè¯ã€å¯†ç å†å²é˜²é‡å¤
- **å¤šè®¾å¤‡ç®¡ç†**: æ”¯æŒå¤šè®¾å¤‡åŒæ—¶åœ¨çº¿ï¼Œè®¾å¤‡ä¿¡æ¯è¿½è¸ª

#### 2. ç”¨æˆ·ä¿¡æ¯ç®¡ç†
- **åŸºç¡€ä¿¡æ¯**: ç”¨æˆ·åã€æ˜µç§°ã€å¤´åƒã€ä¸ªæ€§ç­¾åã€æ€§åˆ«ã€ç”Ÿæ—¥ã€æ‰€åœ¨åœ°
- **è”ç³»æ–¹å¼**: é‚®ç®±ã€æ‰‹æœºå·ï¼ˆæ”¯æŒéªŒè¯ï¼‰
- **åœ¨çº¿çŠ¶æ€**: ONLINEï¼ˆåœ¨çº¿ï¼‰ã€OFFLINEï¼ˆç¦»çº¿ï¼‰ã€BUSYï¼ˆå¿™ç¢Œï¼‰ã€AWAYï¼ˆç¦»å¼€ï¼‰
- **éšç§è®¾ç½®**: ä¿¡æ¯å¯è§æ€§æ§åˆ¶ã€å¥½å‹éªŒè¯è®¾ç½®

#### 3. ç¤¾äº¤å…³ç³»ç®¡ç†
- **å¥½å‹ç³»ç»Ÿ**: æ·»åŠ å¥½å‹ã€åˆ é™¤å¥½å‹ã€å¥½å‹åˆ—è¡¨ã€å¥½å‹å¤‡æ³¨
- **å¥½å‹ç”³è¯·**: ç”³è¯·å‘é€ã€ç”³è¯·å¤„ç†ï¼ˆåŒæ„/æ‹’ç»ï¼‰ã€ç”³è¯·æ¶ˆæ¯
- **å¥½å‹æ¥æº**: æœç´¢æ·»åŠ ã€äºŒç»´ç ã€æ‰‹æœºå·ã€ç¾¤ç»„
- **é»‘åå•**: æ‹‰é»‘ç”¨æˆ·ã€è§£é™¤æ‹‰é»‘

#### 4. ç”¨æˆ·æœç´¢
- **ç²¾ç¡®æœç´¢**: é€šè¿‡ç”¨æˆ·åã€é‚®ç®±ã€æ‰‹æœºå·ç²¾ç¡®æŸ¥æ‰¾
- **æ¨¡ç³Šæœç´¢**: æ”¯æŒæ˜µç§°ã€ç”¨æˆ·åæ¨¡ç³ŠåŒ¹é…
- **é«˜çº§ç­›é€‰**: æŒ‰åœ°åŒºã€æ€§åˆ«ã€åœ¨çº¿çŠ¶æ€ç­‰æ¡ä»¶ç­›é€‰

#### 5. å®‰å…¨ä¸å®¡è®¡
- **ç™»å½•æ—¥å¿—**: è®°å½•æ‰€æœ‰ç™»å½•è¡Œä¸ºï¼ˆæˆåŠŸ/å¤±è´¥ï¼‰ã€IPåœ°å€ã€è®¾å¤‡ä¿¡æ¯
- **å¯†ç ç®¡ç†**: BCryptåŠ å¯†ã€å¯†ç å†å²è®°å½•ã€å®šæœŸæ›´æ¢æé†’
- **è´¦æˆ·çŠ¶æ€**: å¯ç”¨/ç¦ç”¨ã€é”å®š/è§£é”ã€å‡­è¯è¿‡æœŸç®¡ç†
- **é‚®ç®±éªŒè¯**: æ³¨å†ŒéªŒè¯ã€æ‰¾å›å¯†ç ã€æ•æ„Ÿæ“ä½œäºŒæ¬¡éªŒè¯

### æŠ€æœ¯ç‰¹æ€§
- **è®¤è¯æ–¹å¼**: OAuth2 + JWT Token
- **æ•°æ®åº“**: PostgreSQLï¼ˆä¸»åº“ï¼‰+ Redisï¼ˆç¼“å­˜ï¼‰
- **æ¶ˆæ¯é˜Ÿåˆ—**: RabbitMQï¼ˆå¼‚æ­¥ä»»åŠ¡ï¼‰
- **æ–‡ä»¶å­˜å‚¨**: OSSï¼ˆå¤´åƒã€é™„ä»¶ï¼‰
- **æœåŠ¡å‘ç°**: Nacos
- **è´Ÿè½½å‡è¡¡**: Ribbon
- **ç†”æ–­é™çº§**: Sentinel

---

## æœåŠ¡ä¿¡æ¯
- **æœåŠ¡åç§°**: user-service
- **ç«¯å£**: 8001
- **åŸºç¡€è·¯å¾„**: /api/v1/users
- **ç‰ˆæœ¬**: v1.0.0

---

## ç›®å½•
1. [ç”¨æˆ·æ³¨å†Œ](#1-ç”¨æˆ·æ³¨å†Œ)
2. [ç”¨æˆ·ç™»å½•](#2-ç”¨æˆ·ç™»å½•)
3. [è·å–ç”¨æˆ·ä¿¡æ¯](#3-è·å–ç”¨æˆ·ä¿¡æ¯)
4. [æ›´æ–°ç”¨æˆ·ä¿¡æ¯](#4-æ›´æ–°ç”¨æˆ·ä¿¡æ¯)
5. [æœç´¢ç”¨æˆ·](#5-æœç´¢ç”¨æˆ·)
6. [æ·»åŠ å¥½å‹](#6-æ·»åŠ å¥½å‹)
7. [è·å–å¥½å‹åˆ—è¡¨](#7-è·å–å¥½å‹åˆ—è¡¨)
8. [åˆ é™¤å¥½å‹](#8-åˆ é™¤å¥½å‹)

---

## 1. ç”¨æˆ·æ³¨å†Œ

### æ¥å£ä¿¡æ¯
- **URL**: `/register`
- **Method**: `POST`
- **åŠŸèƒ½**: ç”¨æˆ·æ³¨å†Œï¼Œåˆ›å»ºæ–°è´¦å·
- **è®¤è¯**: ä¸éœ€è¦

### Request
```json
{
  "username": "zhangsan",
  "password": "123456",
  "email": "zhangsan@example.com",
  "phone": "13800138000",
  "nickname": "å¼ ä¸‰"
}
```

**å‚æ•°è¯´æ˜**
| å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| username | string | æ˜¯ | ç”¨æˆ·åï¼Œ3-20å­—ç¬¦ï¼Œå­—æ¯æ•°å­—ä¸‹åˆ’çº¿ |
| password | string | æ˜¯ | å¯†ç ï¼Œ6-20å­—ç¬¦ |
| email | string | æ˜¯ | é‚®ç®±åœ°å€ |
| phone | string | æ˜¯ | æ‰‹æœºå·ç  |
| nickname | string | å¦ | æ˜µç§°ï¼Œé»˜è®¤ä¸ºç”¨æˆ·å |

### Response - æˆåŠŸ (200)
```json
{
  "code": 200,
  "message": "æ³¨å†ŒæˆåŠŸ",
  "data": {
    "userId": 10001,
    "username": "zhangsan",
    "nickname": "å¼ ä¸‰",
    "avatar": "https://cdn.example.com/default-avatar.png",
    "email": "zhangsan@example.com",
    "phone": "138****8000",
    "createdAt": "2025-11-09T14:30:00Z"
  }
}
```

### Response - å¤±è´¥
```json
{
  "code": 400,
  "message": "ç”¨æˆ·åå·²å­˜åœ¨",
  "data": null
}
```

**é”™è¯¯ç **
| é”™è¯¯ç  | è¯´æ˜ |
|--------|------|
| 400 | ç”¨æˆ·åå·²å­˜åœ¨ |
| 400 | é‚®ç®±å·²è¢«æ³¨å†Œ |
| 400 | æ‰‹æœºå·å·²è¢«æ³¨å†Œ |
| 400 | å‚æ•°æ ¼å¼é”™è¯¯ |

---

## 2. ç”¨æˆ·ç™»å½•

### æ¥å£ä¿¡æ¯
- **URL**: `/login`
- **Method**: `POST`
- **åŠŸèƒ½**: ç”¨æˆ·ç™»å½•ï¼Œè·å–è®¿é—®ä»¤ç‰Œ
- **è®¤è¯**: ä¸éœ€è¦

### Request
```json
{
  "username": "zhangsan",
  "password": "123456",
  "deviceType": "WEB",
  "deviceId": "device-uuid-123"
}
```

**å‚æ•°è¯´æ˜**
| å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| username | string | æ˜¯ | ç”¨æˆ·åæˆ–é‚®ç®±æˆ–æ‰‹æœºå· |
| password | string | æ˜¯ | å¯†ç  |
| deviceType | string | æ˜¯ | è®¾å¤‡ç±»å‹ï¼šWEB/IOS/ANDROID/PC |
| deviceId | string | æ˜¯ | è®¾å¤‡å”¯ä¸€æ ‡è¯† |

### Response - æˆåŠŸ (200)
```json
{
  "code": 200,
  "message": "ç™»å½•æˆåŠŸ",
  "data": {
    "userId": 10001,
    "username": "zhangsan",
    "nickname": "å¼ ä¸‰",
    "avatar": "https://cdn.example.com/avatar/10001.jpg",
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOjEwMDAxLCJleHAiOjE2OTk1MjA0MDB9.xxx",
    "refreshToken": "refresh_token_xxx",
    "expiresIn": 7200,
    "tokenType": "Bearer"
  }
}
```

### Response - å¤±è´¥
```json
{
  "code": 401,
  "message": "ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯",
  "data": null
}
```

---

## 3. è·å–ç”¨æˆ·ä¿¡æ¯

### æ¥å£ä¿¡æ¯
- **URL**: `/{userId}`
- **Method**: `GET`
- **åŠŸèƒ½**: è·å–æŒ‡å®šç”¨æˆ·çš„è¯¦ç»†ä¿¡æ¯
- **è®¤è¯**: éœ€è¦ Bearer Token

### Request
```
GET /api/v1/users/10001
Headers:
  Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
```

### Response - æˆåŠŸ (200)
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "userId": 10001,
    "username": "zhangsan",
    "nickname": "å¼ ä¸‰",
    "avatar": "https://cdn.example.com/avatar/10001.jpg",
    "email": "zhangsan@example.com",
    "phone": "138****8000",
    "status": "ONLINE",
    "signature": "è¿™æ˜¯æˆ‘çš„ä¸ªæ€§ç­¾å",
    "gender": "MALE",
    "birthday": "1990-01-01",
    "location": "åŒ—äº¬å¸‚",
    "createdAt": "2025-01-01T00:00:00Z",
    "lastLoginAt": "2025-11-09T14:30:00Z"
  }
}
```

---

## 4. æ›´æ–°ç”¨æˆ·ä¿¡æ¯

### æ¥å£ä¿¡æ¯
- **URL**: `/{userId}`
- **Method**: `PUT`
- **åŠŸèƒ½**: æ›´æ–°ç”¨æˆ·èµ„æ–™
- **è®¤è¯**: éœ€è¦ Bearer Token

### Request
```json
{
  "nickname": "æ–°æ˜µç§°",
  "avatar": "https://cdn.example.com/avatar/new.jpg",
  "signature": "æ–°çš„ä¸ªæ€§ç­¾å",
  "gender": "MALE",
  "birthday": "1990-01-01",
  "location": "ä¸Šæµ·å¸‚"
}
```

### Response - æˆåŠŸ (200)
```json
{
  "code": 200,
  "message": "æ›´æ–°æˆåŠŸ",
  "data": {
    "userId": 10001,
    "nickname": "æ–°æ˜µç§°",
    "avatar": "https://cdn.example.com/avatar/new.jpg",
    "signature": "æ–°çš„ä¸ªæ€§ç­¾å",
    "updatedAt": "2025-11-09T15:00:00Z"
  }
}
```

---

## 5. æœç´¢ç”¨æˆ·

### æ¥å£ä¿¡æ¯
- **URL**: `/search`
- **Method**: `GET`
- **åŠŸèƒ½**: æ ¹æ®å…³é”®è¯æœç´¢ç”¨æˆ·
- **è®¤è¯**: éœ€è¦ Bearer Token

### Request
```
GET /api/v1/users/search?keyword=å¼ &page=1&size=20
```

**å‚æ•°è¯´æ˜**
| å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| keyword | string | æ˜¯ | æœç´¢å…³é”®è¯ï¼ˆç”¨æˆ·å/æ˜µç§°/æ‰‹æœºå·ï¼‰ |
| page | integer | å¦ | é¡µç ï¼Œé»˜è®¤1 |
| size | integer | å¦ | æ¯é¡µæ•°é‡ï¼Œé»˜è®¤20ï¼Œæœ€å¤§100 |

### Response - æˆåŠŸ (200)
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "total": 100,
    "page": 1,
    "size": 20,
    "users": [
      {
        "userId": 10001,
        "username": "zhangsan",
        "nickname": "å¼ ä¸‰",
        "avatar": "https://cdn.example.com/avatar/10001.jpg",
        "status": "ONLINE",
        "signature": "ä¸ªæ€§ç­¾å"
      }
    ]
  }
}
```

---

## 6. æ·»åŠ å¥½å‹

### æ¥å£ä¿¡æ¯
- **URL**: `/friends`
- **Method**: `POST`
- **åŠŸèƒ½**: å‘é€å¥½å‹ç”³è¯·
- **è®¤è¯**: éœ€è¦ Bearer Token

### Request
```json
{
  "friendId": 10002,
  "message": "ä½ å¥½ï¼Œæˆ‘æ˜¯å¼ ä¸‰ï¼Œæƒ³åŠ ä½ ä¸ºå¥½å‹",
  "source": "SEARCH",
  "remark": "åŒäº‹"
}
```

### Response - æˆåŠŸ (200)
```json
{
  "code": 200,
  "message": "å¥½å‹ç”³è¯·å·²å‘é€",
  "data": {
    "requestId": "req_123456",
    "status": "PENDING",
    "createdAt": "2025-11-09T15:00:00Z"
  }
}
```

---

## 7. è·å–å¥½å‹åˆ—è¡¨

### æ¥å£ä¿¡æ¯
- **URL**: `/friends`
- **Method**: `GET`
- **åŠŸèƒ½**: è·å–å½“å‰ç”¨æˆ·çš„å¥½å‹åˆ—è¡¨
- **è®¤è¯**: éœ€è¦ Bearer Token

### Request
```
GET /api/v1/users/friends?status=ACCEPTED
```

### Response - æˆåŠŸ (200)
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "total": 50,
    "friends": [
      {
        "userId": 10002,
        "username": "lisi",
        "nickname": "æå››",
        "avatar": "https://cdn.example.com/avatar/10002.jpg",
        "status": "ONLINE",
        "remark": "åŒäº‹",
        "addedAt": "2025-01-15T10:00:00Z"
      }
    ]
  }
}
```

---

## 8. åˆ é™¤å¥½å‹

### æ¥å£ä¿¡æ¯
- **URL**: `/friends/{friendId}`
- **Method**: `DELETE`
- **åŠŸèƒ½**: åˆ é™¤å¥½å‹å…³ç³»
- **è®¤è¯**: éœ€è¦ Bearer Token

### Request
```
DELETE /api/v1/users/friends/10002
```

### Response - æˆåŠŸ (200)
```json
{
  "code": 200,
  "message": "å·²åˆ é™¤å¥½å‹",
  "data": null
}
```

---

## é€šç”¨é”™è¯¯ç 

| é”™è¯¯ç  | è¯´æ˜ |
|--------|------|
| 200 | æˆåŠŸ |
| 400 | è¯·æ±‚å‚æ•°é”™è¯¯ |
| 401 | æœªæˆæƒï¼ˆTokenæ— æ•ˆæˆ–è¿‡æœŸï¼‰ |
| 403 | ç¦æ­¢è®¿é—® |
| 404 | èµ„æºä¸å­˜åœ¨ |
| 409 | èµ„æºå†²çª |
| 429 | è¯·æ±‚è¿‡äºé¢‘ç¹ |
| 500 | æœåŠ¡å™¨å†…éƒ¨é”™è¯¯ |

---

## æ•°æ®æ¨¡å‹

### User
```typescript
interface User {
  userId: number;           // ç”¨æˆ·ID
  username: string;         // ç”¨æˆ·å
  nickname: string;         // æ˜µç§°
  avatar: string;           // å¤´åƒURL
  email: string;            // é‚®ç®±
  phone: string;            // æ‰‹æœºå·ï¼ˆè„±æ•ï¼‰
  status: UserStatus;       // åœ¨çº¿çŠ¶æ€
  signature: string;        // ä¸ªæ€§ç­¾å
  gender: Gender;           // æ€§åˆ«
  birthday: string;         // ç”Ÿæ—¥
  location: string;         // æ‰€åœ¨åœ°
  createdAt: string;        // åˆ›å»ºæ—¶é—´
  updatedAt: string;        // æ›´æ–°æ—¶é—´
  lastLoginAt: string;      // æœ€åç™»å½•æ—¶é—´
}

enum UserStatus {
  ONLINE = 'ONLINE',        // åœ¨çº¿
  OFFLINE = 'OFFLINE',      // ç¦»çº¿
  BUSY = 'BUSY',            // å¿™ç¢Œ
  AWAY = 'AWAY'             // ç¦»å¼€
}

enum Gender {
  MALE = 'MALE',            // ç”·
  FEMALE = 'FEMALE',        // å¥³
  UNKNOWN = 'UNKNOWN'       // æœªçŸ¥
}
```

---

## è°ƒç”¨ç¤ºä¾‹

### JavaScript/TypeScript
```javascript
// ç™»å½•
const login = async (username, password) => {
  const response = await fetch('http://localhost:8001/api/v1/users/login', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json'
    },
    body: JSON.stringify({
      username,
      password,
      deviceType: 'WEB',
      deviceId: 'web-' + Date.now()
    })
  });
  
  const result = await response.json();
  if (result.code === 200) {
    localStorage.setItem('token', result.data.token);
    return result.data;
  }
  throw new Error(result.message);
};

// è·å–ç”¨æˆ·ä¿¡æ¯
const getUserInfo = async (userId) => {
  const token = localStorage.getItem('token');
  const response = await fetch(`http://localhost:8001/api/v1/users/${userId}`, {
    headers: {
      'Authorization': `Bearer ${token}`
    }
  });
  
  const result = await response.json();
  return result.data;
};
```

### Java
```java
// ä½¿ç”¨OpenFeignè°ƒç”¨
@FeignClient(name = "user-service", url = "http://localhost:8001")
public interface UserServiceClient {
    
    @PostMapping("/api/v1/users/login")
    Result<LoginResponse> login(@RequestBody LoginRequest request);
    
    @GetMapping("/api/v1/users/{userId}")
    Result<User> getUserInfo(@PathVariable Long userId,
                             @RequestHeader("Authorization") String token);
}
```

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0.0  
**æœ€åæ›´æ–°**: 2025-11-09  
**ç»´æŠ¤äºº**: å¼€å‘å›¢é˜Ÿ
