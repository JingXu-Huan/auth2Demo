# æœç´¢æœåŠ¡ API æ–‡æ¡£

## ğŸ“‹ æœåŠ¡åŠŸèƒ½è¯´æ˜

æœç´¢æœåŠ¡ä¸ºIMç³»ç»Ÿæä¾›å¼ºå¤§çš„å…¨æ–‡æœç´¢èƒ½åŠ›ï¼Œæ”¯æŒæ¶ˆæ¯ã€ç”¨æˆ·ã€ç¾¤ç»„ã€æ–‡ä»¶ç­‰å¤šç§å†…å®¹çš„å¿«é€Ÿæ£€ç´¢ã€‚æœ¬æœåŠ¡åŸºäºElasticsearchæ„å»ºï¼Œæä¾›æ¯«ç§’çº§çš„æœç´¢å“åº”ï¼Œæ”¯æŒä¸­æ–‡åˆ†è¯ã€æ¨¡ç³ŠåŒ¹é…ã€é«˜äº®æ˜¾ç¤ºç­‰é«˜çº§æœç´¢åŠŸèƒ½ã€‚

### æ ¸å¿ƒåŠŸèƒ½

#### 1. æ¶ˆæ¯æœç´¢
- **å…¨æ–‡æœç´¢**: æœç´¢æ‰€æœ‰èŠå¤©è®°å½•ä¸­çš„æ–‡æœ¬å†…å®¹
- **ä¼šè¯ç­›é€‰**: æŒ‰å•èŠ/ç¾¤èŠç­›é€‰æœç´¢èŒƒå›´
- **æ—¶é—´èŒƒå›´**: æŒ‡å®šæ—¶é—´æ®µå†…çš„æ¶ˆæ¯æœç´¢
- **å‘é€è€…ç­›é€‰**: æŒ‰å‘é€è€…è¿‡æ»¤æœç´¢ç»“æœ
- **æ¶ˆæ¯ç±»å‹**: æŒ‰æ–‡æœ¬ã€å›¾ç‰‡ã€æ–‡ä»¶ç­‰ç±»å‹æœç´¢
- **å…³é”®è¯é«˜äº®**: æœç´¢ç»“æœå…³é”®è¯é«˜äº®æ˜¾ç¤º

#### 2. ç”¨æˆ·æœç´¢
- **ç”¨æˆ·åæœç´¢**: æŒ‰ç”¨æˆ·åç²¾ç¡®æˆ–æ¨¡ç³Šæœç´¢
- **æ˜µç§°æœç´¢**: æ”¯æŒæ˜µç§°æ¨¡ç³ŠåŒ¹é…
- **é‚®ç®±/æ‰‹æœº**: é€šè¿‡é‚®ç®±æˆ–æ‰‹æœºå·æŸ¥æ‰¾ç”¨æˆ·
- **æ ‡ç­¾æœç´¢**: æŒ‰ç”¨æˆ·æ ‡ç­¾æœç´¢
- **é«˜çº§ç­›é€‰**: æŒ‰åœ°åŒºã€æ€§åˆ«ã€åœ¨çº¿çŠ¶æ€ç­‰ç­›é€‰

#### 3. ç¾¤ç»„æœç´¢
- **ç¾¤åæœç´¢**: æŒ‰ç¾¤åç§°æœç´¢ç¾¤ç»„
- **ç¾¤å…¬å‘Šæœç´¢**: æœç´¢ç¾¤å…¬å‘Šå†…å®¹
- **ç¾¤æˆå‘˜æœç´¢**: åœ¨ç¾¤å†…æœç´¢ç‰¹å®šæˆå‘˜
- **ç¾¤ç±»å‹ç­›é€‰**: æŒ‰ç¾¤ç±»å‹ç­›é€‰æœç´¢ç»“æœ

#### 4. æ–‡ä»¶æœç´¢
- **æ–‡ä»¶åæœç´¢**: æŒ‰æ–‡ä»¶åæœç´¢
- **æ–‡ä»¶ç±»å‹**: æŒ‰æ–‡ä»¶ç±»å‹ï¼ˆå›¾ç‰‡ã€æ–‡æ¡£ã€è§†é¢‘ç­‰ï¼‰ç­›é€‰
- **ä¸Šä¼ è€…**: æŒ‰ä¸Šä¼ è€…ç­›é€‰
- **æ—¶é—´èŒƒå›´**: æŒ‡å®šæ—¶é—´æ®µå†…çš„æ–‡ä»¶
- **æ–‡ä»¶å¤§å°**: æŒ‰æ–‡ä»¶å¤§å°èŒƒå›´æœç´¢

#### 5. æœç´¢ä¼˜åŒ–
- **æ™ºèƒ½åˆ†è¯**: ä¸­æ–‡æ™ºèƒ½åˆ†è¯ï¼Œæé«˜æœç´¢å‡†ç¡®åº¦
- **æ‹¼éŸ³æœç´¢**: æ”¯æŒæ‹¼éŸ³é¦–å­—æ¯æœç´¢
- **çº é”™å»ºè®®**: æ‹¼å†™é”™è¯¯è‡ªåŠ¨çº æ­£å»ºè®®
- **æœç´¢è”æƒ³**: è¾“å…¥æ—¶å®æ—¶è”æƒ³æ¨è
- **çƒ­é—¨æœç´¢**: ç»Ÿè®¡å’Œå±•ç¤ºçƒ­é—¨æœç´¢è¯

#### 6. æœç´¢å†å²
- **å†å²è®°å½•**: ä¿å­˜ç”¨æˆ·æœç´¢å†å²
- **å¿«é€Ÿæœç´¢**: å¿«é€Ÿè®¿é—®å†å²æœç´¢
- **æ¸…é™¤å†å²**: æ”¯æŒæ¸…é™¤æœç´¢å†å²
- **æœç´¢ç»Ÿè®¡**: æœç´¢è¡Œä¸ºåˆ†æ

### æŠ€æœ¯ç‰¹æ€§
- **æœç´¢å¼•æ“**: Elasticsearch 7.x
- **ä¸­æ–‡åˆ†è¯**: IK Analyzer
- **æ•°æ®åŒæ­¥**: Logstashï¼ˆæ•°æ®åŒæ­¥ï¼‰
- **ç¼“å­˜**: Redisï¼ˆçƒ­é—¨æœç´¢ã€æœç´¢å†å²ï¼‰
- **æ¶ˆæ¯é˜Ÿåˆ—**: RabbitMQï¼ˆç´¢å¼•æ›´æ–°ï¼‰
- **æœåŠ¡å‘ç°**: Nacos

---

## æœåŠ¡ä¿¡æ¯
- **æœåŠ¡åç§°**: search-service
- **ç«¯å£**: 8007
- **åŸºç¡€è·¯å¾„**: /api/v1/search
- **ç‰ˆæœ¬**: v1.0.0

---

## æ ¸å¿ƒæ¥å£

### 1. æœç´¢æ¶ˆæ¯
- **URL**: `/messages`
- **Method**: `GET`
- **åŠŸèƒ½**: å…¨æ–‡æœç´¢èŠå¤©æ¶ˆæ¯

**Request**:
```
GET /api/v1/search/messages?keyword=æŠ€æœ¯&userId=10001&page=1&size=20
```

**å‚æ•°è¯´æ˜**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| keyword | string | æ˜¯ | æœç´¢å…³é”®è¯ |
| userId | number | æ˜¯ | ç”¨æˆ·ID |
| page | integer | å¦ | é¡µç ï¼Œé»˜è®¤1 |
| size | integer | å¦ | æ¯é¡µæ•°é‡ï¼Œé»˜è®¤20 |

**Response**:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "total": 15,
    "page": 1,
    "size": 20,
    "results": [
      {
        "messageId": "msg_123456",
        "content": "è®¨è®ºæŠ€æœ¯é—®é¢˜",
        "senderId": 10002,
        "senderName": "æå››",
        "chatType": "PRIVATE",
        "timestamp": "2025-11-09T14:00:00Z",
        "highlight": "è®¨è®º<em>æŠ€æœ¯</em>é—®é¢˜"
      }
    ]
  }
}
```

---

### 2. æœç´¢ç”¨æˆ·
- **URL**: `/users`
- **Method**: `GET`
- **åŠŸèƒ½**: æœç´¢ç”¨æˆ·

**Request**:
```
GET /api/v1/search/users?keyword=å¼ ä¸‰&page=1&size=20
```

**Response**:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "total": 5,
    "page": 1,
    "size": 20,
    "results": [
      {
        "userId": 10001,
        "username": "zhangsan",
        "nickname": "å¼ ä¸‰",
        "avatar": "https://cdn.example.com/avatar/10001.jpg",
        "signature": "çƒ­çˆ±æŠ€æœ¯",
        "isFriend": false
      }
    ]
  }
}
```

---

### 3. æœç´¢ç¾¤ç»„
- **URL**: `/groups`
- **Method**: `GET`
- **åŠŸèƒ½**: æœç´¢ç¾¤ç»„

**Request**:
```
GET /api/v1/search/groups?keyword=æŠ€æœ¯äº¤æµ&page=1&size=20
```

**Response**:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "total": 3,
    "page": 1,
    "size": 20,
    "results": [
      {
        "groupId": "group_001",
        "name": "æŠ€æœ¯äº¤æµç¾¤",
        "description": "è®¨è®ºæŠ€æœ¯é—®é¢˜çš„ç¾¤ç»„",
        "avatar": "https://cdn.example.com/group-avatar.jpg",
        "memberCount": 50,
        "joinType": "FREE",
        "isMember": false
      }
    ]
  }
}
```

---

### 4. ç»¼åˆæœç´¢
- **URL**: `/all`
- **Method**: `GET`
- **åŠŸèƒ½**: æœç´¢æ‰€æœ‰ç±»å‹ï¼ˆç”¨æˆ·ã€ç¾¤ç»„ã€æ¶ˆæ¯ï¼‰

**Request**:
```
GET /api/v1/search/all?keyword=æŠ€æœ¯&userId=10001
```

**Response**:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "users": {
      "total": 5,
      "results": [...]
    },
    "groups": {
      "total": 3,
      "results": [...]
    },
    "messages": {
      "total": 15,
      "results": [...]
    }
  }
}
```

---

### 5. æœç´¢å»ºè®®
- **URL**: `/suggest`
- **Method**: `GET`
- **åŠŸèƒ½**: è·å–æœç´¢å»ºè®®ï¼ˆè‡ªåŠ¨è¡¥å…¨ï¼‰

**Request**:
```
GET /api/v1/search/suggest?keyword=æŠ€&type=USER
```

**Response**:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "suggestions": [
      "æŠ€æœ¯äº¤æµç¾¤",
      "æŠ€æœ¯åˆ†äº«",
      "æŠ€æœ¯è®¨è®º"
    ]
  }
}
```

---

## æœç´¢ç±»å‹

| ç±»å‹ | è¯´æ˜ |
|------|------|
| USER | ç”¨æˆ·æœç´¢ |
| GROUP | ç¾¤ç»„æœç´¢ |
| MESSAGE | æ¶ˆæ¯æœç´¢ |
| ALL | ç»¼åˆæœç´¢ |

---

## æœç´¢ç‰¹æ€§

- âœ… å…¨æ–‡æœç´¢
- âœ… æ¨¡ç³ŠåŒ¹é…
- âœ… é«˜äº®æ˜¾ç¤º
- âœ… åˆ†é¡µæ”¯æŒ
- âœ… æœç´¢å»ºè®®
- âœ… æœç´¢å†å²

---

## æ•°æ®æ¨¡å‹

```typescript
interface SearchResult<T> {
  total: number;
  page: number;
  size: number;
  results: T[];
}

interface MessageSearchResult {
  messageId: string;
  content: string;
  senderId: number;
  senderName: string;
  chatType: 'PRIVATE' | 'GROUP';
  timestamp: string;
  highlight: string;
}
```

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0.0  
**æœ€åæ›´æ–°**: 2025-11-09  
**ç»´æŠ¤äºº**: å¼€å‘å›¢é˜Ÿ
