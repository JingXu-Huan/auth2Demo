# å®¡æ‰¹æœåŠ¡ API æ–‡æ¡£

## æœåŠ¡ä¿¡æ¯
- **æœåŠ¡åç§°**: approval-service
- **ç«¯å£**: 8016
- **åŸºç¡€è·¯å¾„**: /api/v1/approvals
- **ç‰ˆæœ¬**: v1.0.0

---

## ğŸ“‹ æœåŠ¡åŠŸèƒ½è¯´æ˜

### æ ¸å¿ƒåŠŸèƒ½
å®¡æ‰¹æœåŠ¡æä¾›å®Œæ•´çš„å®¡æ‰¹æµç¨‹ç®¡ç†ï¼Œæ”¯æŒè¯·å‡ã€æŠ¥é”€ã€é‡‡è´­ç­‰å„ç±»å®¡æ‰¹åœºæ™¯ï¼Œæä¾›çµæ´»çš„å®¡æ‰¹æµé…ç½®å’Œå¼ºå¤§çš„æµç¨‹å¼•æ“ã€‚

### ä¸»è¦ç‰¹æ€§

#### 1. å®¡æ‰¹æµç¨‹
- âœ… **æµç¨‹æ¨¡æ¿**: é¢„å®šä¹‰å®¡æ‰¹æ¨¡æ¿
- âœ… **è‡ªå®šä¹‰æµç¨‹**: è‡ªå®šä¹‰å®¡æ‰¹èŠ‚ç‚¹
- âœ… **å¤šçº§å®¡æ‰¹**: æ”¯æŒå¤šçº§å®¡æ‰¹
- âœ… **å¹¶è¡Œå®¡æ‰¹**: ä¼šç­¾ã€æˆ–ç­¾
- âœ… **æ¡ä»¶åˆ†æ”¯**: æ ¹æ®æ¡ä»¶è·¯ç”±
- âœ… **æŠ„é€é€šçŸ¥**: æŠ„é€ç›¸å…³äººå‘˜

#### 2. å®¡æ‰¹ç±»å‹
- âœ… **è¯·å‡å®¡æ‰¹**: å¹´å‡ã€ç—…å‡ã€äº‹å‡
- âœ… **æŠ¥é”€å®¡æ‰¹**: å·®æ—…ã€é‡‡è´­æŠ¥é”€
- âœ… **ç”¨ç« å®¡æ‰¹**: å…¬ç« ã€åˆåŒç« 
- âœ… **é‡‡è´­å®¡æ‰¹**: ç‰©èµ„é‡‡è´­ç”³è¯·
- âœ… **å‡ºå·®å®¡æ‰¹**: å‡ºå·®ç”³è¯·
- âœ… **åŠ ç­å®¡æ‰¹**: åŠ ç­ç”³è¯·

#### 3. å®¡æ‰¹æ“ä½œ
- âœ… **æäº¤å®¡æ‰¹**: å‘èµ·å®¡æ‰¹ç”³è¯·
- âœ… **åŒæ„**: å®¡æ‰¹é€šè¿‡
- âœ… **æ‹’ç»**: å®¡æ‰¹é©³å›
- âœ… **è½¬å®¡**: è½¬ç»™ä»–äººå®¡æ‰¹
- âœ… **æ’¤å›**: æ’¤å›å®¡æ‰¹
- âœ… **å‚¬åŠ**: å‚¬ä¿ƒå®¡æ‰¹

#### 4. æµç¨‹ç®¡ç†
- âœ… **æµç¨‹è®¾è®¡**: å¯è§†åŒ–æµç¨‹è®¾è®¡
- âœ… **æµç¨‹ç›‘æ§**: å®æ—¶ç›‘æ§æµç¨‹
- âœ… **æµç¨‹ç»Ÿè®¡**: å®¡æ‰¹æ•°æ®ç»Ÿè®¡
- âœ… **æµç¨‹ä¼˜åŒ–**: æµç¨‹ä¼˜åŒ–å»ºè®®

### ä¸šåŠ¡åœºæ™¯

#### åœºæ™¯1: è¯·å‡å®¡æ‰¹
```
å‘˜å·¥æäº¤è¯·å‡ç”³è¯·
  â†“
ç›´å±ä¸»ç®¡å®¡æ‰¹
  â†“
(è¯·å‡>3å¤©) â†’ éƒ¨é—¨ç»ç†å®¡æ‰¹
  â†“
(è¯·å‡>7å¤©) â†’ HRå®¡æ‰¹
  â†“
å®¡æ‰¹å®Œæˆï¼Œè‡ªåŠ¨åŒæ­¥æ—¥å†
```

#### åœºæ™¯2: æŠ¥é”€å®¡æ‰¹
```
å‘˜å·¥æäº¤æŠ¥é”€ç”³è¯·
  â†“
ç›´å±ä¸»ç®¡å®¡æ‰¹
  â†“
(é‡‘é¢>1000) â†’ è´¢åŠ¡å®¡æ‰¹
  â†“
(é‡‘é¢>5000) â†’ æ€»ç»ç†å®¡æ‰¹
  â†“
å®¡æ‰¹å®Œæˆï¼Œè´¢åŠ¡æ‰“æ¬¾
```

---

## 1. åˆ›å»ºå®¡æ‰¹

### Request
```json
{
  "templateId": "tpl_leave",
  "title": "å¹´å‡ç”³è¯·",
  "formData": {
    "leaveType": "ANNUAL",
    "startDate": "2025-11-20",
    "endDate": "2025-11-22",
    "days": 3,
    "reason": "å›å®¶æ¢äº²"
  },
  "attachments": [
    {
      "name": "æœºç¥¨.pdf",
      "url": "https://cdn.example.com/ticket.pdf"
    }
  ]
}
```

### Response
```json
{
  "code": 200,
  "message": "æäº¤æˆåŠŸ",
  "data": {
    "approvalId": "apv_123456",
    "title": "å¹´å‡ç”³è¯·",
    "status": "PENDING",
    "currentNode": "ç›´å±ä¸»ç®¡å®¡æ‰¹",
    "currentApprovers": [10002],
    "createdAt": "2025-11-10T12:00:00Z"
  }
}
```

---

## 2. å®¡æ‰¹æ“ä½œ

### Request
```json
{
  "action": "APPROVE",
  "comment": "åŒæ„",
  "attachments": []
}
```

### Response
```json
{
  "code": 200,
  "message": "å®¡æ‰¹æˆåŠŸ",
  "data": {
    "approvalId": "apv_123456",
    "status": "APPROVED",
    "nextNode": "éƒ¨é—¨ç»ç†å®¡æ‰¹",
    "nextApprovers": [10003],
    "approvedAt": "2025-11-10T14:00:00Z"
  }
}
```

---

## æ•°æ®æ¨¡å‹

### Approval
```typescript
interface Approval {
  approvalId: string;           // å®¡æ‰¹ID
  templateId: string;           // æ¨¡æ¿ID
  title: string;                // æ ‡é¢˜
  applicantId: number;          // ç”³è¯·äººID
  status: ApprovalStatus;       // çŠ¶æ€
  formData: object;             // è¡¨å•æ•°æ®
  currentNode: string;          // å½“å‰èŠ‚ç‚¹
  currentApprovers: number[];   // å½“å‰å®¡æ‰¹äºº
  history: ApprovalHistory[];   // å®¡æ‰¹å†å²
  createdAt: string;            // åˆ›å»ºæ—¶é—´
  completedAt: string;          // å®Œæˆæ—¶é—´
}

enum ApprovalStatus {
  PENDING = 'PENDING',          // å¾…å®¡æ‰¹
  APPROVED = 'APPROVED',        // å·²é€šè¿‡
  REJECTED = 'REJECTED',        // å·²æ‹’ç»
  CANCELLED = 'CANCELLED',      // å·²æ’¤é”€
  EXPIRED = 'EXPIRED'           // å·²è¿‡æœŸ
}

enum ApprovalAction {
  APPROVE = 'APPROVE',          // åŒæ„
  REJECT = 'REJECT',            // æ‹’ç»
  TRANSFER = 'TRANSFER',        // è½¬å®¡
  WITHDRAW = 'WITHDRAW'         // æ’¤å›
}
```

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0.0  
**æœ€åæ›´æ–°**: 2025-11-11  
**ç»´æŠ¤äºº**: å¼€å‘å›¢é˜Ÿ
