# éƒ¨ç½²è¿ç»´æ–‡æ¡£ (Deployment & Operations Document)

## ğŸ“‹ æ–‡æ¡£ä¿¡æ¯

| é¡¹ç›®ä¿¡æ¯ | è¯¦æƒ… |
|---------|------|
| **é¡¹ç›®åç§°** | AIO ä¼ä¸šçº§å³æ—¶é€šè®¯ç³»ç»Ÿ |
| **æ–‡æ¡£ç±»å‹** | éƒ¨ç½²è¿ç»´æ–‡æ¡£ |
| **æ–‡æ¡£ç‰ˆæœ¬** | v1.0.0 |
| **åˆ›å»ºæ—¥æœŸ** | 2025-11-12 |
| **è¿ç»´å›¢é˜Ÿ** | DevOpså›¢é˜Ÿ |

---

## ğŸ¯ éƒ¨ç½²æ¶æ„æ¦‚è§ˆ

### æ•´ä½“éƒ¨ç½²æ¶æ„
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        è´Ÿè½½å‡è¡¡å±‚                            â”‚
â”‚                    Nginx / HAProxy                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      åº”ç”¨å±‚                                  â”‚
â”‚  Gateway Ã— 2  â”‚  User-Service Ã— 3  â”‚  Message-Service Ã— 3  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ä¸­é—´ä»¶å±‚                                  â”‚
â”‚  PostgreSQLä¸»ä»  â”‚  MongoDBå‰¯æœ¬é›†  â”‚  Redisé›†ç¾¤             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ› ï¸ ç¯å¢ƒå‡†å¤‡

### 1. ç¡¬ä»¶è¦æ±‚

#### ç”Ÿäº§ç¯å¢ƒé…ç½®
| ç»„ä»¶ | CPU | å†…å­˜ | ç£ç›˜ | ç½‘ç»œ |
|------|-----|------|------|------|
| åº”ç”¨æœåŠ¡å™¨ | 8æ ¸+ | 16GB+ | 200GB SSD | 1Gbps |
| æ•°æ®åº“æœåŠ¡å™¨ | 16æ ¸+ | 32GB+ | 500GB SSD | 1Gbps |
| RedisæœåŠ¡å™¨ | 4æ ¸+ | 8GB+ | 100GB SSD | 1Gbps |
| è´Ÿè½½å‡è¡¡å™¨ | 4æ ¸+ | 8GB+ | 50GB SSD | 1Gbps |

#### å¼€å‘ç¯å¢ƒé…ç½®
| ç»„ä»¶ | CPU | å†…å­˜ | ç£ç›˜ |
|------|-----|------|------|
| å¼€å‘æœºå™¨ | 4æ ¸+ | 8GB+ | 100GB |

### 2. è½¯ä»¶ç¯å¢ƒ

#### åŸºç¡€è½¯ä»¶ç‰ˆæœ¬
| è½¯ä»¶ | ç‰ˆæœ¬ | è¯´æ˜ |
|------|------|------|
| **æ“ä½œç³»ç»Ÿ** | Ubuntu 20.04 LTS | æ¨èä½¿ç”¨LTSç‰ˆæœ¬ |
| **Docker** | 20.10+ | å®¹å™¨è¿è¡Œç¯å¢ƒ |
| **Docker Compose** | 2.0+ | å®¹å™¨ç¼–æ’å·¥å…· |
| **JDK** | OpenJDK 11 | Javaè¿è¡Œç¯å¢ƒ |
| **Node.js** | 16.x LTS | å‰ç«¯æ„å»ºç¯å¢ƒ |

---

## ğŸ³ Dockerå®¹å™¨åŒ–éƒ¨ç½²

### 1. åº”ç”¨æœåŠ¡Dockerfile

#### åç«¯æœåŠ¡Dockerfile
```dockerfile
# User-Service Dockerfile
FROM openjdk:11-jre-slim

LABEL maintainer="devops@example.com"
LABEL version="1.0.0"

# è®¾ç½®å·¥ä½œç›®å½•
WORKDIR /app

# å¤åˆ¶jaråŒ…
COPY target/user-service-1.0.0.jar app.jar

# åˆ›å»ºérootç”¨æˆ·
RUN groupadd -r appuser && useradd -r -g appuser appuser
RUN chown -R appuser:appuser /app
USER appuser

# å¥åº·æ£€æŸ¥
HEALTHCHECK --interval=30s --timeout=3s --start-period=60s --retries=3 \
  CMD curl -f http://localhost:8001/actuator/health || exit 1

# æš´éœ²ç«¯å£
EXPOSE 8001

# JVMå‚æ•°ä¼˜åŒ–
ENV JAVA_OPTS="-Xms512m -Xmx1024m -XX:+UseG1GC -XX:+PrintGCDetails"

# å¯åŠ¨åº”ç”¨
ENTRYPOINT ["sh", "-c", "java $JAVA_OPTS -jar app.jar"]
```

#### å‰ç«¯Dockerfile
```dockerfile
# Frontend Dockerfile
FROM node:16-alpine AS builder

WORKDIR /app
COPY package*.json ./
RUN npm ci --only=production

COPY . .
RUN npm run build

FROM nginx:alpine
COPY --from=builder /app/dist /usr/share/nginx/html
COPY nginx.conf /etc/nginx/nginx.conf

EXPOSE 80
CMD ["nginx", "-g", "daemon off;"]
```

### 2. Docker Composeé…ç½®

#### å¼€å‘ç¯å¢ƒ docker-compose.dev.yml
```yaml
version: '3.8'

services:
  # æ•°æ®åº“æœåŠ¡
  postgres:
    image: postgres:13
    container_name: aio-postgres
    environment:
      POSTGRES_DB: aio_db
      POSTGRES_USER: aio_user
      POSTGRES_PASSWORD: aio_password
    volumes:
      - postgres_data:/var/lib/postgresql/data
      - ./init-scripts:/docker-entrypoint-initdb.d
    ports:
      - "5432:5432"
    networks:
      - aio-network

  mongodb:
    image: mongo:5.0
    container_name: aio-mongodb
    environment:
      MONGO_INITDB_ROOT_USERNAME: admin
      MONGO_INITDB_ROOT_PASSWORD: admin123
    volumes:
      - mongodb_data:/data/db
    ports:
      - "27017:27017"
    networks:
      - aio-network

  redis:
    image: redis:6.2-alpine
    container_name: aio-redis
    command: redis-server --requirepass redis123
    volumes:
      - redis_data:/data
    ports:
      - "6379:6379"
    networks:
      - aio-network

  # åº”ç”¨æœåŠ¡
  user-service:
    build:
      context: ./User-server
      dockerfile: Dockerfile
    container_name: aio-user-service
    environment:
      SPRING_PROFILES_ACTIVE: docker
      DB_HOST: postgres
      DB_PORT: 5432
      REDIS_HOST: redis
      REDIS_PORT: 6379
    depends_on:
      - postgres
      - redis
    ports:
      - "8001:8001"
    networks:
      - aio-network

  gateway:
    build:
      context: ./Gateway
      dockerfile: Dockerfile
    container_name: aio-gateway
    environment:
      SPRING_PROFILES_ACTIVE: docker
    depends_on:
      - user-service
    ports:
      - "9000:9000"
    networks:
      - aio-network

volumes:
  postgres_data:
  mongodb_data:
  redis_data:

networks:
  aio-network:
    driver: bridge
```

---

## â˜¸ï¸ Kuberneteséƒ¨ç½²

### 1. å‘½åç©ºé—´é…ç½®
```yaml
# namespace.yaml
apiVersion: v1
kind: Namespace
metadata:
  name: aio-system
  labels:
    name: aio-system
```

### 2. ConfigMapé…ç½®
```yaml
# configmap.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: aio-config
  namespace: aio-system
data:
  application.yml: |
    spring:
      profiles:
        active: k8s
      datasource:
        url: jdbc:postgresql://postgres-service:5432/aio_db
        username: aio_user
        password: ${DB_PASSWORD}
      redis:
        host: redis-service
        port: 6379
        password: ${REDIS_PASSWORD}
```

### 3. åº”ç”¨éƒ¨ç½²é…ç½®
```yaml
# user-service-deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: user-service
  namespace: aio-system
spec:
  replicas: 3
  selector:
    matchLabels:
      app: user-service
  template:
    metadata:
      labels:
        app: user-service
    spec:
      containers:
      - name: user-service
        image: aio/user-service:1.0.0
        ports:
        - containerPort: 8001
        env:
        - name: DB_PASSWORD
          valueFrom:
            secretKeyRef:
              name: aio-secrets
              key: db-password
        - name: REDIS_PASSWORD
          valueFrom:
            secretKeyRef:
              name: aio-secrets
              key: redis-password
        resources:
          requests:
            memory: "512Mi"
            cpu: "250m"
          limits:
            memory: "1Gi"
            cpu: "500m"
        livenessProbe:
          httpGet:
            path: /actuator/health
            port: 8001
          initialDelaySeconds: 60
          periodSeconds: 30
        readinessProbe:
          httpGet:
            path: /actuator/health
            port: 8001
          initialDelaySeconds: 30
          periodSeconds: 10

---
apiVersion: v1
kind: Service
metadata:
  name: user-service
  namespace: aio-system
spec:
  selector:
    app: user-service
  ports:
  - port: 8001
    targetPort: 8001
  type: ClusterIP
```

---

## ğŸ”§ CI/CDæµæ°´çº¿

### 1. GitLab CIé…ç½®
```yaml
# .gitlab-ci.yml
stages:
  - test
  - build
  - deploy

variables:
  DOCKER_REGISTRY: registry.example.com
  PROJECT_NAME: aio-system

# æµ‹è¯•é˜¶æ®µ
test:
  stage: test
  image: openjdk:11
  services:
    - postgres:13
    - redis:6.2
  variables:
    POSTGRES_DB: test_db
    POSTGRES_USER: test
    POSTGRES_PASSWORD: test
  script:
    - ./mvnw clean test
    - ./mvnw jacoco:report
  coverage: '/Total.*?([0-9]{1,3})%/'
  artifacts:
    reports:
      junit: target/surefire-reports/TEST-*.xml
      coverage_report:
        coverage_format: jacoco
        path: target/site/jacoco/jacoco.xml

# æ„å»ºé˜¶æ®µ
build:
  stage: build
  image: docker:20.10
  services:
    - docker:20.10-dind
  before_script:
    - docker login -u $CI_REGISTRY_USER -p $CI_REGISTRY_PASSWORD $CI_REGISTRY
  script:
    - docker build -t $CI_REGISTRY_IMAGE/user-service:$CI_COMMIT_SHA ./User-server
    - docker push $CI_REGISTRY_IMAGE/user-service:$CI_COMMIT_SHA
  only:
    - main
    - develop

# éƒ¨ç½²é˜¶æ®µ
deploy:
  stage: deploy
  image: kubectl:latest
  script:
    - kubectl set image deployment/user-service user-service=$CI_REGISTRY_IMAGE/user-service:$CI_COMMIT_SHA -n aio-system
    - kubectl rollout status deployment/user-service -n aio-system
  environment:
    name: production
    url: https://aio.example.com
  only:
    - main
```

---

## ğŸ“Š ç›‘æ§å‘Šè­¦

### 1. Prometheusç›‘æ§é…ç½®
```yaml
# prometheus.yml
global:
  scrape_interval: 15s

scrape_configs:
  - job_name: 'aio-services'
    static_configs:
      - targets: ['user-service:8001', 'message-service:8002']
    metrics_path: '/actuator/prometheus'
    scrape_interval: 10s

  - job_name: 'postgres'
    static_configs:
      - targets: ['postgres-exporter:9187']

  - job_name: 'redis'
    static_configs:
      - targets: ['redis-exporter:9121']
```

### 2. Grafanaä»ªè¡¨æ¿
```json
{
  "dashboard": {
    "title": "AIOç³»ç»Ÿç›‘æ§",
    "panels": [
      {
        "title": "QPS",
        "type": "graph",
        "targets": [
          {
            "expr": "rate(http_requests_total[5m])",
            "legendFormat": "{{service}}"
          }
        ]
      },
      {
        "title": "å“åº”æ—¶é—´",
        "type": "graph",
        "targets": [
          {
            "expr": "histogram_quantile(0.95, rate(http_request_duration_seconds_bucket[5m]))",
            "legendFormat": "95th percentile"
          }
        ]
      }
    ]
  }
}
```

---

## ğŸš¨ æ•…éšœå¤„ç†

### 1. å¸¸è§é—®é¢˜æ’æŸ¥

#### æœåŠ¡å¯åŠ¨å¤±è´¥
```bash
# æ£€æŸ¥å®¹å™¨çŠ¶æ€
docker ps -a

# æŸ¥çœ‹å®¹å™¨æ—¥å¿—
docker logs container_name

# æ£€æŸ¥ç«¯å£å ç”¨
netstat -tlnp | grep :8001
```

#### æ•°æ®åº“è¿æ¥é—®é¢˜
```bash
# æ£€æŸ¥æ•°æ®åº“è¿æ¥
docker exec -it postgres psql -U aio_user -d aio_db

# æ£€æŸ¥æ•°æ®åº“çŠ¶æ€
docker exec postgres pg_isready
```

### 2. åº”æ€¥é¢„æ¡ˆ

#### æœåŠ¡é™çº§ç­–ç•¥
1. å…³é—­éæ ¸å¿ƒåŠŸèƒ½
2. å¯ç”¨ç¼“å­˜é™çº§
3. é™åˆ¶å¹¶å‘è®¿é—®
4. å¯ç”¨ç†”æ–­æœºåˆ¶

#### æ•°æ®å¤‡ä»½æ¢å¤
```bash
# æ•°æ®åº“å¤‡ä»½
docker exec postgres pg_dump -U aio_user aio_db > backup.sql

# æ•°æ®åº“æ¢å¤
docker exec -i postgres psql -U aio_user aio_db < backup.sql
```

---

## ğŸ“‹ è¿ç»´æ£€æŸ¥æ¸…å•

### æ—¥å¸¸æ£€æŸ¥é¡¹ç›®
- [ ] æœåŠ¡å¥åº·çŠ¶æ€æ£€æŸ¥
- [ ] ç³»ç»Ÿèµ„æºä½¿ç”¨æƒ…å†µ
- [ ] æ•°æ®åº“è¿æ¥æ± çŠ¶æ€
- [ ] ç¼“å­˜å‘½ä¸­ç‡æ£€æŸ¥
- [ ] æ—¥å¿—é”™è¯¯ä¿¡æ¯æ£€æŸ¥
- [ ] ç£ç›˜ç©ºé—´ä½¿ç”¨æƒ…å†µ
- [ ] ç½‘ç»œè¿æ¥çŠ¶æ€æ£€æŸ¥

### å®šæœŸç»´æŠ¤é¡¹ç›®
- [ ] æ•°æ®åº“å¤‡ä»½éªŒè¯
- [ ] æ—¥å¿—æ–‡ä»¶æ¸…ç†
- [ ] ç³»ç»Ÿå®‰å…¨æ›´æ–°
- [ ] æ€§èƒ½æŒ‡æ ‡åˆ†æ
- [ ] å®¹é‡è§„åˆ’è¯„ä¼°

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0.0  
**åˆ›å»ºæ—¥æœŸ**: 2025-11-12  
**ç»´æŠ¤äºº**: DevOpså›¢é˜Ÿ
