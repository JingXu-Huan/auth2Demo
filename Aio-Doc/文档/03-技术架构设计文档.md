# æŠ€æœ¯æ¶æ„è®¾è®¡æ–‡æ¡£ (Technical Architecture Document)

## ğŸ“‹ æ–‡æ¡£ä¿¡æ¯

| é¡¹ç›®ä¿¡æ¯ | è¯¦æƒ… |
|---------|------|
| **é¡¹ç›®åç§°** | AIO ä¼ä¸šçº§å³æ—¶é€šè®¯ç³»ç»Ÿ |
| **æ–‡æ¡£ç±»å‹** | æŠ€æœ¯æ¶æ„è®¾è®¡æ–‡æ¡£ |
| **æ–‡æ¡£ç‰ˆæœ¬** | v1.0.0 |
| **åˆ›å»ºæ—¥æœŸ** | 2025-11-12 |
| **æ¶æ„å¸ˆ** | æŠ€æœ¯å›¢é˜Ÿ |
| **æŠ€æœ¯æ ˆ** | Spring Boot + Spring Cloud + Vue.js |

---

## ğŸ—ï¸ æ•´ä½“æ¶æ„è®¾è®¡

### ç³»ç»Ÿæ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        å®¢æˆ·ç«¯å±‚                              â”‚
â”‚  Webç«¯ / iOSç«¯ / Androidç«¯ / PCç«¯ / å°ç¨‹åº                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      API ç½‘å…³å±‚                              â”‚
â”‚  IM-Gateway (è´Ÿè½½å‡è¡¡ã€è·¯ç”±ã€é‰´æƒã€é™æµ)                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    å¾®æœåŠ¡å±‚                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ç”¨æˆ·æœåŠ¡ â”‚ æ¶ˆæ¯æœåŠ¡ â”‚ ç¾¤ç»„æœåŠ¡ â”‚ æ–‡ä»¶æœåŠ¡ â”‚ éŸ³è§†é¢‘æœåŠ¡      â”‚
â”‚ æœç´¢æœåŠ¡ â”‚ æ¨é€æœåŠ¡ â”‚ ç»„ç»‡æœåŠ¡ â”‚ æ—¥ç¨‹æœåŠ¡ â”‚ ä»»åŠ¡æœåŠ¡        â”‚
â”‚ ä¼šè®®æœåŠ¡ â”‚ æœºå™¨äººæœåŠ¡â”‚ å®¡æ‰¹æœåŠ¡ â”‚ äº‘æ–‡æ¡£æœåŠ¡â”‚ é€šçŸ¥æœåŠ¡       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ä¸­é—´ä»¶å±‚                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Nacos     â”‚ Redis      â”‚ RabbitMQ   â”‚ Elasticsearch        â”‚
â”‚ Sentinel  â”‚ PostgreSQL â”‚ MinIO      â”‚ WebRTC Server        â”‚
â”‚ Zipkin    â”‚ MongoDB    â”‚ Kafka      â”‚ FFmpeg               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ¶æ„ç‰¹ç‚¹

#### 1. å¾®æœåŠ¡æ¶æ„
- **æœåŠ¡æ‹†åˆ†**: æŒ‰ä¸šåŠ¡é¢†åŸŸæ‹†åˆ†ä¸º11ä¸ªæ ¸å¿ƒå¾®æœåŠ¡
- **ç‹¬ç«‹éƒ¨ç½²**: æ¯ä¸ªæœåŠ¡å¯ç‹¬ç«‹å¼€å‘ã€æµ‹è¯•ã€éƒ¨ç½²
- **æŠ€æœ¯æ ˆ**: ç»Ÿä¸€ä½¿ç”¨Spring Boot 2.7.18 + Spring Cloud Alibaba
- **æ•°æ®éš”ç¦»**: æ¯ä¸ªæœåŠ¡æ‹¥æœ‰ç‹¬ç«‹çš„æ•°æ®åº“

#### 2. äº‘åŸç”Ÿè®¾è®¡
- **å®¹å™¨åŒ–**: æ‰€æœ‰æœåŠ¡æ”¯æŒDockerå®¹å™¨åŒ–éƒ¨ç½²
- **æœåŠ¡å‘ç°**: åŸºäºNacosçš„æœåŠ¡æ³¨å†Œä¸å‘ç°
- **é…ç½®ä¸­å¿ƒ**: ç»Ÿä¸€çš„é…ç½®ç®¡ç†å’ŒåŠ¨æ€é…ç½®æ›´æ–°
- **é“¾è·¯è¿½è¸ª**: åŸºäºZipkinçš„åˆ†å¸ƒå¼é“¾è·¯è¿½è¸ª

#### 3. é«˜å¯ç”¨è®¾è®¡
- **è´Ÿè½½å‡è¡¡**: Gatewayå±‚å®ç°è¯·æ±‚è´Ÿè½½å‡è¡¡
- **ç†”æ–­é™çº§**: Sentinelå®ç°æœåŠ¡ç†”æ–­å’Œé™æµ
- **æ•°æ®å¤‡ä»½**: å¤šå‰¯æœ¬æ•°æ®å­˜å‚¨å’Œå®šæœŸå¤‡ä»½
- **æ•…éšœè½¬ç§»**: è‡ªåŠ¨æ•…éšœæ£€æµ‹å’ŒæœåŠ¡è½¬ç§»

---

## ğŸ”§ æŠ€æœ¯é€‰å‹

### åç«¯æŠ€æœ¯æ ˆ

| æŠ€æœ¯ç»„ä»¶ | ç‰ˆæœ¬ | ç”¨é€” | é€‰å‹ç†ç”± |
|---------|------|------|---------|
| **Spring Boot** | 2.7.18 | å¾®æœåŠ¡æ¡†æ¶ | æˆç†Ÿç¨³å®šã€ç”Ÿæ€ä¸°å¯Œ |
| **Spring Cloud Alibaba** | 2021.0.5.0 | å¾®æœåŠ¡æ²»ç† | å›½äº§åŒ–ã€åŠŸèƒ½å®Œæ•´ |
| **Nacos** | 2.2.0 | æœåŠ¡æ³¨å†Œ/é…ç½®ä¸­å¿ƒ | é˜¿é‡Œå¼€æºã€åŠŸèƒ½å¼ºå¤§ |
| **Sentinel** | 1.8.6 | æµé‡æ§åˆ¶/ç†”æ–­ | å®æ—¶ç›‘æ§ã€è§„åˆ™çµæ´» |
| **PostgreSQL** | 13+ | å…³ç³»å‹æ•°æ®åº“ | æ€§èƒ½ä¼˜ç§€ã€åŠŸèƒ½ä¸°å¯Œ |
| **MongoDB** | 5.0+ | æ–‡æ¡£æ•°æ®åº“ | é€‚åˆæ¶ˆæ¯å­˜å‚¨ |
| **Redis** | 6.2+ | ç¼“å­˜/ä¼šè¯å­˜å‚¨ | é«˜æ€§èƒ½ã€æ•°æ®ç»“æ„ä¸°å¯Œ |
| **RabbitMQ** | 3.9+ | æ¶ˆæ¯é˜Ÿåˆ— | å¯é æ€§é«˜ã€åŠŸèƒ½å®Œæ•´ |
| **Elasticsearch** | 7.17+ | æœç´¢å¼•æ“ | å…¨æ–‡æœç´¢ã€å®æ—¶åˆ†æ |
| **MinIO** | RELEASE.2023 | å¯¹è±¡å­˜å‚¨ | S3å…¼å®¹ã€ç§æœ‰åŒ–éƒ¨ç½² |

### å‰ç«¯æŠ€æœ¯æ ˆ

| æŠ€æœ¯ç»„ä»¶ | ç‰ˆæœ¬ | ç”¨é€” | é€‰å‹ç†ç”± |
|---------|------|------|---------|
| **Vue.js** | 3.4.0 | å‰ç«¯æ¡†æ¶ | æ˜“å­¦æ˜“ç”¨ã€ç”Ÿæ€å®Œå–„ |
| **Vite** | 5.0.0 | æ„å»ºå·¥å…· | å¿«é€Ÿæ„å»ºã€çƒ­æ›´æ–° |
| **Element Plus** | 2.4.0 | UIç»„ä»¶åº“ | ä¼ä¸šçº§ã€ç»„ä»¶ä¸°å¯Œ |
| **Pinia** | 2.1.0 | çŠ¶æ€ç®¡ç† | Vue3å®˜æ–¹æ¨è |
| **TypeScript** | 5.0+ | ç±»å‹ç³»ç»Ÿ | ç±»å‹å®‰å…¨ã€å¼€å‘æ•ˆç‡ |
| **SockJS** | 1.6.1 | WebSocketå®¢æˆ·ç«¯ | å…¼å®¹æ€§å¥½ã€é™çº§æ”¯æŒ |

---

## ğŸ¢ å¾®æœåŠ¡è®¾è®¡

### æœåŠ¡åˆ—è¡¨

#### 1. ç”¨æˆ·æœåŠ¡ (User Service)
- **ç«¯å£**: 8001
- **èŒè´£**: ç”¨æˆ·æ³¨å†Œã€ç™»å½•ã€ä¿¡æ¯ç®¡ç†ã€å¥½å‹å…³ç³»
- **æ•°æ®åº“**: PostgreSQL
- **å…³é”®æ¥å£**:
  - `POST /api/v1/users/register` - ç”¨æˆ·æ³¨å†Œ
  - `POST /api/v1/users/login` - ç”¨æˆ·ç™»å½•
  - `GET /api/v1/users/{userId}` - è·å–ç”¨æˆ·ä¿¡æ¯
  - `GET /api/v1/users/friends` - è·å–å¥½å‹åˆ—è¡¨

#### 2. æ¶ˆæ¯æœåŠ¡ (Message Service)
- **ç«¯å£**: 8002
- **èŒè´£**: æ¶ˆæ¯æ”¶å‘ã€å†å²è®°å½•ã€å·²è¯»æœªè¯»
- **æ•°æ®åº“**: MongoDB + Redis
- **å…³é”®æ¥å£**:
  - `POST /api/v1/messages/private` - å‘é€ç§èŠæ¶ˆæ¯
  - `POST /api/v1/messages/group` - å‘é€ç¾¤èŠæ¶ˆæ¯
  - `GET /api/v1/messages/history` - è·å–å†å²æ¶ˆæ¯

#### 3. ç¾¤ç»„æœåŠ¡ (Group Service)
- **ç«¯å£**: 8003
- **èŒè´£**: ç¾¤ç»„ç®¡ç†ã€æˆå‘˜ç®¡ç†ã€æƒé™æ§åˆ¶
- **æ•°æ®åº“**: PostgreSQL + Redis
- **å…³é”®æ¥å£**:
  - `POST /api/v1/groups` - åˆ›å»ºç¾¤ç»„
  - `POST /api/v1/groups/{groupId}/members` - æ·»åŠ æˆå‘˜
  - `GET /api/v1/groups/{groupId}` - è·å–ç¾¤ç»„ä¿¡æ¯

#### 4. æ–‡ä»¶æœåŠ¡ (File Service)
- **ç«¯å£**: 8005
- **èŒè´£**: æ–‡ä»¶ä¸Šä¼ ã€ä¸‹è½½ã€é¢„è§ˆ
- **å­˜å‚¨**: MinIO + PostgreSQL(å…ƒæ•°æ®)
- **å…³é”®æ¥å£**:
  - `POST /api/v1/files/upload` - ä¸Šä¼ æ–‡ä»¶
  - `GET /api/v1/files/{fileId}` - ä¸‹è½½æ–‡ä»¶
  - `GET /api/v1/files/{fileId}/preview` - é¢„è§ˆæ–‡ä»¶

#### 5. éŸ³è§†é¢‘æœåŠ¡ (Media Service)
- **ç«¯å£**: 8008
- **èŒè´£**: éŸ³è§†é¢‘é€šè¯ã€ä¼šè®®ç®¡ç†
- **æŠ€æœ¯**: WebRTC + FFmpeg
- **å…³é”®æ¥å£**:
  - `POST /api/v1/media/call/start` - å‘èµ·é€šè¯
  - `POST /api/v1/media/meeting/create` - åˆ›å»ºä¼šè®®
  - `GET /api/v1/media/meeting/{meetingId}` - è·å–ä¼šè®®ä¿¡æ¯

### æœåŠ¡é—´é€šä¿¡

#### åŒæ­¥è°ƒç”¨ - OpenFeign
```java
@FeignClient(name = "user-service")
public interface UserServiceClient {
    @GetMapping("/api/v1/users/{userId}")
    Result<UserDTO> getUserInfo(@PathVariable Long userId);
}
```

#### å¼‚æ­¥æ¶ˆæ¯ - RabbitMQ
```java
// æ¶ˆæ¯å‘é€
@RabbitListener(queues = "message.send.queue")
public void handleMessageSend(MessageEvent event) {
    // å¤„ç†æ¶ˆæ¯å‘é€äº‹ä»¶
}
```

#### å®æ—¶é€šä¿¡ - WebSocket
```java
@MessageMapping("/chat/private")
public void sendPrivateMessage(PrivateMessageDTO message) {
    // å¤„ç†ç§èŠæ¶ˆæ¯
    messagingTemplate.convertAndSendToUser(
        message.getReceiverId().toString(),
        "/queue/messages", 
        message
    );
}
```

---

## ğŸ—„ï¸ æ•°æ®æ¶æ„è®¾è®¡

### æ•°æ®å­˜å‚¨ç­–ç•¥

#### 1. å…³ç³»å‹æ•°æ®åº“ (PostgreSQL)
**ç”¨é€”**: ç”¨æˆ·ä¿¡æ¯ã€ç¾¤ç»„ä¿¡æ¯ã€ç³»ç»Ÿé…ç½®ç­‰ç»“æ„åŒ–æ•°æ®
```sql
-- ç”¨æˆ·è¡¨
CREATE TABLE users (
    user_id BIGSERIAL PRIMARY KEY,
    username VARCHAR(50) NOT NULL UNIQUE,
    email VARCHAR(100) NOT NULL UNIQUE,
    password_hash VARCHAR(255) NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

#### 2. æ–‡æ¡£æ•°æ®åº“ (MongoDB)
**ç”¨é€”**: æ¶ˆæ¯è®°å½•ã€èŠå¤©å†å²ç­‰åŠç»“æ„åŒ–æ•°æ®
```javascript
// æ¶ˆæ¯æ–‡æ¡£ç»“æ„
{
  "_id": ObjectId("..."),
  "messageId": "msg_123456",
  "senderId": 10001,
  "receiverId": 10002,
  "messageType": "TEXT",
  "content": "Hello World",
  "timestamp": ISODate("2025-11-12T10:00:00Z"),
  "status": "DELIVERED"
}
```

#### 3. ç¼“å­˜æ•°æ®åº“ (Redis)
**ç”¨é€”**: ä¼šè¯å­˜å‚¨ã€çƒ­ç‚¹æ•°æ®ç¼“å­˜ã€è®¡æ•°å™¨
```java
// ç”¨æˆ·åœ¨çº¿çŠ¶æ€ç¼“å­˜
redisTemplate.opsForValue().set(
    "user:online:" + userId, 
    "true", 
    Duration.ofMinutes(30)
);
```

### æ•°æ®åˆ†ç‰‡ç­–ç•¥

#### æ¶ˆæ¯åˆ†ç‰‡
- **åˆ†ç‰‡é”®**: æ ¹æ®ä¼šè¯IDè¿›è¡Œåˆ†ç‰‡
- **åˆ†ç‰‡è§„åˆ™**: Hash(conversationId) % åˆ†ç‰‡æ•°é‡
- **ä¼˜åŠ¿**: åŒä¸€ä¼šè¯çš„æ¶ˆæ¯åœ¨åŒä¸€åˆ†ç‰‡ï¼ŒæŸ¥è¯¢æ•ˆç‡é«˜

#### ç”¨æˆ·åˆ†ç‰‡
- **åˆ†ç‰‡é”®**: æ ¹æ®ç”¨æˆ·IDè¿›è¡Œåˆ†ç‰‡  
- **åˆ†ç‰‡è§„åˆ™**: userId % åˆ†ç‰‡æ•°é‡
- **ä¼˜åŠ¿**: ç”¨æˆ·æ•°æ®åˆ†å¸ƒå‡åŒ€

---

## ğŸ” å®‰å…¨æ¶æ„è®¾è®¡

### è®¤è¯æˆæƒä½“ç³»

#### 1. OAuth2 + JWTè®¤è¯
```java
// JWT Tokenç”Ÿæˆ
public String generateToken(UserDetails userDetails) {
    return Jwts.builder()
        .setSubject(userDetails.getUsername())
        .setIssuedAt(new Date())
        .setExpiration(new Date(System.currentTimeMillis() + 7200000))
        .signWith(SignatureAlgorithm.HS256, secretKey)
        .compact();
}
```

#### 2. æœåŠ¡é—´è®¤è¯
```java
// æœåŠ¡é—´TokenéªŒè¯
@Component
public class ServiceAuthFilter implements Filter {
    @Override
    public void doFilter(ServletRequest request, ServletResponse response, 
                        FilterChain chain) throws IOException, ServletException {
        String serviceToken = ((HttpServletRequest) request)
            .getHeader("X-Service-Auth");
        
        if (validateServiceToken(serviceToken)) {
            chain.doFilter(request, response);
        } else {
            ((HttpServletResponse) response).setStatus(403);
        }
    }
}
```

### æ•°æ®å®‰å…¨

#### 1. ä¼ è¾“åŠ å¯†
- æ‰€æœ‰APIæ¥å£ä½¿ç”¨HTTPS
- WebSocketè¿æ¥ä½¿ç”¨WSS
- æ•°æ®åº“è¿æ¥ä½¿ç”¨SSL

#### 2. å­˜å‚¨åŠ å¯†
```java
// æ•æ„Ÿæ•°æ®åŠ å¯†å­˜å‚¨
@Entity
public class User {
    @Column(name = "password_hash")
    private String passwordHash; // BCryptåŠ å¯†
    
    @Column(name = "phone")
    @Encrypted // è‡ªå®šä¹‰åŠ å¯†æ³¨è§£
    private String phone;
}
```

---

## ğŸ“Š ç›‘æ§ä¸è¿ç»´

### ç›‘æ§ä½“ç³»

#### 1. åº”ç”¨ç›‘æ§
```yaml
# Prometheusé…ç½®
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics,prometheus
  endpoint:
    health:
      show-details: always
```

#### 2. é“¾è·¯è¿½è¸ª
```yaml
# Zipkiné…ç½®
spring:
  sleuth:
    sampler:
      probability: 1.0
  zipkin:
    base-url: http://zipkin-server:9411
```

#### 3. æ—¥å¿—æ”¶é›†
```yaml
# Logbacké…ç½®
<appender name="STDOUT" class="ch.qos.logback.core.ConsoleAppender">
    <encoder class="net.logstash.logback.encoder.LoggingEventCompositeJsonEncoder">
        <providers>
            <timestamp/>
            <logLevel/>
            <loggerName/>
            <message/>
            <mdc/>
        </providers>
    </encoder>
</appender>
```

### éƒ¨ç½²æ¶æ„

#### 1. å®¹å™¨åŒ–éƒ¨ç½²
```dockerfile
# Dockerfileç¤ºä¾‹
FROM openjdk:8-jre-alpine
COPY target/user-service.jar app.jar
EXPOSE 8001
ENTRYPOINT ["java", "-jar", "/app.jar"]
```

#### 2. Kuberneteséƒ¨ç½²
```yaml
# Deploymenté…ç½®
apiVersion: apps/v1
kind: Deployment
metadata:
  name: user-service
spec:
  replicas: 3
  selector:
    matchLabels:
      app: user-service
  template:
    metadata:
      labels:
        app: user-service
    spec:
      containers:
      - name: user-service
        image: user-service:1.0.0
        ports:
        - containerPort: 8001
```

---

## ğŸš€ æ€§èƒ½ä¼˜åŒ–

### ç¼“å­˜ç­–ç•¥

#### 1. å¤šçº§ç¼“å­˜
```java
// L1ç¼“å­˜ï¼šæœ¬åœ°ç¼“å­˜
@Cacheable(value = "users", key = "#userId")
public User getUserById(Long userId) {
    return userRepository.findById(userId);
}

// L2ç¼“å­˜ï¼šRedisåˆ†å¸ƒå¼ç¼“å­˜
@Cacheable(value = "user_sessions", key = "#token")
public UserSession getSessionByToken(String token) {
    return sessionRepository.findByToken(token);
}
```

#### 2. æ•°æ®åº“ä¼˜åŒ–
```sql
-- ç´¢å¼•ä¼˜åŒ–
CREATE INDEX CONCURRENTLY idx_messages_conversation_time 
ON messages(conversation_id, created_at DESC);

-- åˆ†åŒºè¡¨
CREATE TABLE messages_2025_11 PARTITION OF messages
FOR VALUES FROM ('2025-11-01') TO ('2025-12-01');
```

### å¼‚æ­¥å¤„ç†

#### 1. æ¶ˆæ¯é˜Ÿåˆ—
```java
// å¼‚æ­¥æ¶ˆæ¯å¤„ç†
@RabbitListener(queues = "message.notification.queue")
public void handleMessageNotification(MessageNotificationEvent event) {
    // å¼‚æ­¥å‘é€æ¨é€é€šçŸ¥
    pushService.sendNotification(event);
}
```

#### 2. çº¿ç¨‹æ± é…ç½®
```java
@Configuration
public class AsyncConfig {
    @Bean
    public Executor taskExecutor() {
        ThreadPoolTaskExecutor executor = new ThreadPoolTaskExecutor();
        executor.setCorePoolSize(10);
        executor.setMaxPoolSize(50);
        executor.setQueueCapacity(200);
        executor.setThreadNamePrefix("async-");
        executor.initialize();
        return executor;
    }
}
```

---

## ğŸ“ˆ æ‰©å±•æ€§è®¾è®¡

### æ°´å¹³æ‰©å±•

#### 1. æ— çŠ¶æ€æœåŠ¡
- æ‰€æœ‰å¾®æœåŠ¡è®¾è®¡ä¸ºæ— çŠ¶æ€
- ä¼šè¯ä¿¡æ¯å­˜å‚¨åœ¨Redisä¸­
- æ”¯æŒå¤šå®ä¾‹è´Ÿè½½å‡è¡¡

#### 2. æ•°æ®åº“æ‰©å±•
- è¯»å†™åˆ†ç¦»ï¼šä¸»åº“å†™å…¥ï¼Œä»åº“è¯»å–
- åˆ†åº“åˆ†è¡¨ï¼šæŒ‰ä¸šåŠ¡å‚ç›´æ‹†åˆ†ï¼ŒæŒ‰æ•°æ®é‡æ°´å¹³æ‹†åˆ†
- ç¼“å­˜å±‚ï¼šå‡å°‘æ•°æ®åº“è®¿é—®å‹åŠ›

### å‚ç›´æ‰©å±•

#### 1. æœåŠ¡æ‹†åˆ†
- æŒ‰ä¸šåŠ¡é¢†åŸŸè¿›ä¸€æ­¥ç»†åˆ†æœåŠ¡
- ç‹¬ç«‹çš„æ•°æ®å­˜å‚¨å’Œè®¡ç®—èµ„æº
- æœåŠ¡é—´æ¾è€¦åˆè®¾è®¡

#### 2. æŠ€æœ¯å‡çº§
- æ”¯æŒæ–°ç‰ˆæœ¬æŠ€æœ¯æ ˆå¹³æ»‘å‡çº§
- å‘åå…¼å®¹çš„APIè®¾è®¡
- æ¸è¿›å¼æ¶æ„æ¼”è¿›

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0.0  
**åˆ›å»ºæ—¥æœŸ**: 2025-11-12  
**æœ€åæ›´æ–°**: 2025-11-12  
**ç»´æŠ¤äºº**: æ¶æ„å›¢é˜Ÿ
