server:
  port: 8002
  # address: 127.0.0.1  # 注释掉，允许外部访问

spring:
  application:
    name: IM-message-server
  datasource:
    driver-class-name: org.postgresql.Driver
    url: jdbc:postgresql://localhost:5432/postgres?currentSchema=public
    username: postgres
    password: 271224
  redis:
    host: localhost
    port: 6379
    database: 0
    timeout: 2000ms
    lettuce:
      pool:
        max-active: 8
        max-wait: -1ms
        max-idle: 8
        min-idle: 0
  
  # RabbitMQ 配置
  rabbitmq:
    host: 154.219.109.125
    port: 5672
    username: guest
    password: guest
    listener:
      simple:
        acknowledge-mode: auto
        retry:
          enabled: true
          initial-interval: 3000
          max-attempts: 3
  
  data:
    mongodb:
      uri: mongodb://localhost:27017/im_chat
  cloud:
    nacos:
      discovery:
        server-addr: 154.219.109.125:8848  # Nacos 服务器地址
        namespace: public                # 命名空间
        group: DEFAULT_GROUP
      config:
        import-check:
          enabled: false                   # 禁用配置导入检查
    sentinel:
      enabled: true
      eager: true
      transport:
        dashboard: localhost:8858  # Sentinel 控制台地址
        port: 8720                 # 与控制台通信的端口（不同于 auth-server）
      filter:
        enabled: true
      web-context-unify: false

  mybatis-plus:
    mapper-locations: classpath:mapper/*.xml
    type-aliases-package: com.example.user.model
    configuration:
      map-underscore-to-camel-case: true
      log-impl: org.apache.ibatis.logging.stdout.StdOutImpl
    global-config:
      db-config:
        id-type: auto
        table-prefix: ""
        # 更新策略：包含 null 值
        update-strategy: ignored
# 自定义配置
chat:
  redis:
    topic: chat-messages

# 服务间认证配置
service:
  auth:
    secret: "IM-message-server-secret-key-for-service-authentication-2025"

# 日志配置
logging:
  level:
    org.example.imserver: INFO
    org.springframework.web.socket: DEBUG
    org.springframework.security: DEBUG
